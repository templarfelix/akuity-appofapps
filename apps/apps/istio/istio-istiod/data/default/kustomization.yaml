apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- telemetry.yaml
helmCharts:
- name: istiod
  namespace: istio-system
  includeCRDs: true
  releaseName: istio-istiod
  version: 1.18.2
  repo: https://istio-release.storage.googleapis.com/charts
  # https://artifacthub.io/packages/helm/istio-official/istiod?modal=values
  valuesInline:
    istio_cni: 
      enabled: true
    meshConfig:
      enableTracing: true
      accessLogFile: /dev/stdout
      extensionProviders:
      - name: otel
        envoyOtelAls:
          service: opentelemetry-collector.monitoring.svc.cluster.local
          port: 4317
      - name: "opencensus"
        opencensus:
            service: "opentelemetry-collector.monitoring.svc.cluster.local"
            port: 55678
            context:
            - W3C_TRACE_CONTEXT
      defaultProviders:
        tracing:
        - "opencensus"
        accessLogging:
        - envoy
        - otel